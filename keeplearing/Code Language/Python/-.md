## 前言

在使用Python开发时，遇到了很多配置环境的情形。有时需要安装不同版本的Python，有时需要安装不同的Python包，有时需要安装不同的Python包的不同版本。

最开始使用时我基本上都是看网上的教程，不同的Python项目可能使用不同的环境管理工具，不知不觉就用过了`pip`、`conda`、`mamba`、`virtualenv`、`venv`等等。这些工具各有优劣，有时候我也会混用，导致环境变量混乱，有时候还会出现冲突。

由于一直没有什么一致性，导致电脑上的Python环境比较乱，我自己也感觉云里雾里的，所以我打算总结一下这些工具的使用方法，以及它们的优缺点。最后会给出我自己推荐的一些使用方法。

## 一、Python 管理工具分类

Python管理工具可以分为两类：

1. **包管理工具**：用于安装、卸载、更新Python包，如`pip`、`conda`、`mamba`等。
2. **环境管理工具**：用于管理Python环境，如`venv`、`virtualenv`、`conda`、`mamba`等。

## 二、包管理工具

pip

conda

mamba

poetry

## 三、环境管理工具

### 3.1 venv

`venv`是Python自带的环境管理工具，其使用起来是最简单，也是最不需要操心的。

#### 3.1.2 使用方法

1. 创建一个新的环境：
    
```bash
python -m venv .venv
```
    
    这样就会在当前目录下创建一个`.venv`的文件夹，里面包含了一个新的Python环境。当然，这里的`.venv`可以替换成任何你想要的名字，用`.venv`是因为这样可以创建一个自动隐藏的文件夹，在git中也很容易把它忽略掉。
    
    注意，这里的`python`是你想要创建环境的Python版本，如果你有多个Python版本，可以使用`python3`或者`python3.10`等。
    
2. 激活这个环境：
    
    如果是Linux系统或者MacOS系统，可以使用如下命令：
    
```bash
source .venv/bin/activate
```
    
    如果是Windows系统，可以使用如下命令：

	```bash
	.venv\\Scripts\\activate
	```
    
3. 安装Python包：
    
    在激活环境之后，使用`pip`安装Python包会把包安装到这个环境中，而不是全局环境。安装的包会放在`.venv/lib/python3.10/site-packages`目录下。
    
```bash
pip install numpy
```
    
4. 退出环境：
    
    在环境中使用`deactivate`命令可以退出环境。
    
```bash
deactivate
```
    

#### 3.1.2 优缺点
- 优点：
    - 原生工具，简单易用，不需要安装额外的软件
    - 速度快，因为不需要下载额外的软件包
    - 环境隔离，不会影响全局环境
    - 可以在任何地方创建环境，不需要管理员权限
    - 每个项目中的环境都在本项目目录下，与其他项目做到了物理隔离，不易弄混
- 缺点：
    - 每个项目都需要创建一个新的环境，如果有很多项目，会占用很多空间
    - 无法共享环境，如果有多个项目使用同一个环境，需要重复创建
    - 不好切换Python版本，每个环境都是一个Python版本，无法切换
    - 只适用于Python 3.3及以上版本

简单来说，如果你不在意空间占用，不需要切换Python版本，那么`venv`是一个很好的选择。

### 3.2 virtualenv
由于`venv`有很大的占用空间的问题，所以有人开发了`virtualenv`，它是一个第三方的环境管理工具，可以解决`venv`的一些问题。

`virtualenv`的使用方法和`venv`基本一样，只是需要安装`virtualenv`这个包。

#### 3.2.1 使用方法

1. 安装`virtualenv`:
2. 创建一个新的环境：
3. 激活这个环境的方式和`venv`一样
4. 安装 Python 包的方式和 `venv` 一样

但它和`venv`的区别在于，`virtualenv`会复用系统的Python库，不会重复安装，所以占用的空间会小很多。如果你不想复用系统的Python库，可以使用`--no-site-packages`选项，在本项目中安装全新的Python库。

1. 退出环境的方式和`venv`一样。

#### 3.2.2 优缺点

- 优点：
    - 可以指定Python版本。
    - 可以共享环境，不需要重复创建。
    - 占用空间小，不会重复安装Python库。
    - 适用于Python 2.7及以上版本。
- 缺点：
    - 非原生工具，需要安装额外的软件。

简单来说，如果你在意空间占用，且想要和`venv`相似的使用体验，那么`virtualenv`是一个很好的选择。

### 3.3 conda

`conda`是一个非常强大的环境管理工具，它不仅可以管理Python环境，还可以管理其他语言的环境，如R、Julia等。

#### 3.3.1 conda、Anaconda、miniconda、mamba、micromamba 之间的关系

- `conda`是Anaconda的一部分，Anaconda是一个数据科学家常用的工具包，里面包含了很多数据科学家常用的软件包，如`numpy`、`pandas`、`scipy`等。但有用户反映Anaconda安装的软件包太多，占用空间太大，所以有人开发了`miniconda`，它是Anaconda的精简版，只包含了`conda`和一些基本的软件包。
- 不管是Anaconda还是miniconda，都是使用`conda`这个包管理工具来管理环境，但`conda`在安装软件包时是单线程的，速度比较慢，所以有人开发了`mamba`，它是`conda`的一个加速版，速度比`conda`快很多。
- `mamba`和`conda`的使用方法基本一样，只是在安装软件包时使用`mamba`代替`conda`。用户基本可以认为，`mamba`命令是`conda`命令的一个别名。
- `micromamba`是`mamba`的一个精简版，`micromamba`的`base`环境是空的，不包含任何软件包。

#### 3.3.2 conda 的原理（也适用于 mamba）

- `conda`环境管理工具会在用户的家目录下创建一个`.conda`文件夹，里面包含了所有的环境，每个环境都是一个文件夹，里面包含了一个Python环境和一个软件包列表。
- 用户每创建一个新的环境，`conda`环境管理工具就会在`.conda`文件夹下创建一个新的文件夹，里面包含了一个新的Python环境和一个新的软件包列表。用户每安装一个新的软件包，`conda`包管理工具就会把这个软件包安装到对应的环境中。
- 用户每激活一个环境，`conda`环境管理工具就会把这个环境的Python环境和软件包列表添加到环境变量中，用户每退出一个环境，`conda`环境管理工具就会把这个环境的Python环境和软件包列表从环境变量中删除。
- 创建好的`conda`环境跟某个项目无关，用户可以在任何地方激活这个环境，不需要在项目目录下创建环境。

#### 3.3.3 使用方法（以 mamba 为例）

1. 安装 `conda` 或者 `mamba`：
    
    在 miniforge 找到最小化的 `conda` 或者 `mamba` 安装包，下载安装即可。
    
2. 创建一个新的环境：
    
```bash
mamba create -n myenv python=3.10
```
    
    这里的 myenv 是环境的名字， python=3.10 是指定 Python 的版本。
    
3. 激活这个环境：
    
```bash
mamaba activate myenv
```
    
4. 安装 Python 包：
    
```bash
mamba install numpy
```
    
5. 退出环境：
    
```bash
mamba deactivate
```
    

**3.3.4 优缺点**

- 优点：
    - 可以指定Python版本。
    - 可以共享环境，不需要重复创建。
    - 可以安装其他语言的环境。
    - 速度快，因为有`mamba`这个加速版。
    - 可以在任何地方激活环境，不需要在项目目录下创建环境。
    - 可以共享软件包，不需要重复下载。
- 缺点：
    - 非原生工具，需要安装额外的软件。
    - 环境跟具体项目是分离的，对于较久未使用的环境，可能会忘记这个环境是干什么的。对于较久未使用的项目，可能会忘记这个项目使用的是哪个环境。

简单来说，如果你想要一个强大的环境管理工具，而且想要安装包时速度快，那么`conda`或者`mamba`是一个很好的选择。但在开发某个项目时，最好标注一下这个项目使用的是哪个环境，以免忘记。

### 3.4 冻结环境

无论使用哪种环境管理工具，都可以使用`pip freeze`命令来冻结环境，即把当前环境的软件包列表保存到一个文件中。

```bash
pip freeze > requirements.txt
```

这样就会在当前目录下创建一个`requirements.txt`文件，里面包含了当前环境的软件包列表。当你需要在另一个环境中安装这些软件包时，可以使用如下命令：

```bash
pip install -r requirements.txt
```

这样就会安装`requirements.txt`文件中列出的所有软件包。

## 四、包、环境管理工具

### 4.1 rye

### 4.2 uv

## 五、总结

- 如果你不在意空间占用，适用高于3.3版本的Python，不需要切换Python版本，只想要一个最简单的环境管理工具，那么`venv`是一个很好的选择。
- 如果你在意空间占用，想要共享环境，适用于2.7及以上版本的Python，那么`virtualenv`是一个很好的选择。
- 如果你想要一个强大的环境管理工具，想要安装包时速度快，那么`conda`或者`mamba`是一个很好的选择。